import{j as e,r as i,a as O}from"./index-B3ie1F2B.js";import{N as $}from"./Navbar-CXPgFggP.js";import{F as L}from"./Footer-BLSME1uV.js";import{M as P}from"./MensajeFlotante-DKxu7Cuh.js";import{s as A,u as H}from"./useUsuario-DqHBhlC3.js";function J({contenidos:s,onActualizarIncompletos:l}){const p=s.filter(r=>!r.sinopsis||!r.imagen||!r.generos||Array.isArray(r.generos)&&r.generos.length===0?!0:r.media_type==="movie"?!r.duracion||r.duracion===0:r.media_type==="tv"?!r.temporadas||r.temporadas===0||!r.episodios_totales||r.episodios_totales===0:!1);function x(r){if(!r.sinopsis)return"sinopsis";if(!r.imagen)return"imagen";if(!r.generos||Array.isArray(r.generos)&&r.generos.length===0)return"gÃ©neros";if(r.media_type==="movie"&&(!r.duracion||r.duracion===0))return"duraciÃ³n";if(r.media_type==="tv"){if(!r.temporadas||r.temporadas===0)return"temporadas";if(!r.episodios_totales||r.episodios_totales===0)return"episodios"}return"dato desconocido"}return p.length===0?null:e.jsxs("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-semibold text-yellow-800",children:["Contenidos incompletos detectados: ",p.length]}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:l,children:"Actualizar desde TMDb"})]}),e.jsxs("ul",{className:"list-disc ml-6 text-yellow-900 text-sm max-h-32 overflow-y-auto",children:[p.slice(0,10).map(r=>e.jsxs("li",{children:["#",r.id," -"," ",r.nombre||e.jsx("span",{className:"italic text-gray-400",children:"Sin nombre"}),e.jsxs("span",{className:"ml-2 text-xs text-yellow-700",children:["(falta: ",e.jsx("strong",{children:x(r)}),")"]})]},r.id)),p.length>10&&e.jsxs("li",{className:"italic text-gray-500",children:["...y ",p.length-10," mÃ¡s"]})]})]})}function K({contenidos:s,loading:l,tiposDisponibles:p,busqueda:x,setBusqueda:r,filtroTipo:t,setFiltroTipo:h,busquedaId:n,setBusquedaId:f,pagina:g,setPagina:w,totalPaginas:b,contenidosPagina:d,seleccionados:j,setSeleccionados:m,accionBatch:S,setAccionBatch:o,handleBatchAction:y,handleSort:N,sortBy:c,sortIcon:_,formatearFecha:E,handleRecalcularTipo:u}){return e.jsxs(e.Fragment,{children:[e.jsx(J,{contenidos:s,onActualizarIncompletos:y}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar por nombre...",value:x,onChange:a=>r(a.target.value),className:"border px-2 py-1 rounded"}),e.jsxs("select",{value:t,onChange:a=>h(a.target.value),className:"border px-2 py-1 rounded",children:[e.jsx("option",{value:"",children:"Todos los tipos"}),p.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsx("input",{type:"text",placeholder:"Buscar por ID...",value:n,onChange:a=>f(a.target.value),className:"border px-2 py-1 rounded w-24"})]}),e.jsxs("div",{className:"my-4 flex gap-2 items-center",children:[e.jsxs("select",{value:S,onChange:a=>o(a.target.value),className:"border px-2 py-1 rounded",children:[e.jsx("option",{value:"",children:"Selecciona una acciÃ³n"}),e.jsx("option",{value:"borrar",children:"Borrar seleccionados"}),e.jsx("option",{value:"actualizar_contenido",children:"Actualizar contenido"}),e.jsx("option",{value:"actualizar_traducciones",children:"Actualizar traducciones"}),e.jsx("option",{value:"cargar_temporadas",children:"Cargar temporadas/capÃ­tulos"}),e.jsx("option",{value:"forzar_actualizar_temporadas",children:"Forzar actualizaciÃ³n temporadas"}),e.jsx("option",{value:"actualizar_duraciones",children:"Actualizar duraciones (series)"}),e.jsx("option",{value:"actualizar_duracion_pelicula",children:"Actualizar duraciÃ³n (pelÃ­culas)"}),e.jsx("option",{value:"actualizar_generos",children:"Actualizar gÃ©neros"}),e.jsx("option",{value:"recalcular_tipo",children:"Recalcular tipo"})]}),e.jsx("button",{className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700",onClick:y,children:"Aplicar"})]}),e.jsxs("table",{className:"w-full table-auto border-collapse text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"border px-2 py-1",children:e.jsx("input",{type:"checkbox",checked:j.length>0&&j.length===d.length,onChange:a=>{a.target.checked?m(d.map(k=>k.id)):m([])}})}),e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>N("id"),children:["ID",_("id")]}),e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>N("nombre"),children:["Nombre",_("nombre")]}),e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>N("tipo"),children:["Tipo",_("tipo")]}),e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>N("anio"),children:["AÃ±o",_("anio")]}),e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>N("finalizada"),children:["Finalizada",_("finalizada")]}),e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>N("ultima_actualizacion"),children:["Ãšltima ActualizaciÃ³n",_("ultima_actualizacion")]}),e.jsx("th",{className:"border px-2 py-1",children:"TÃ­tulo original"}),e.jsx("th",{className:"border px-2 py-1",children:"PuntuaciÃ³n"}),e.jsx("th",{className:"border px-2 py-1",children:"GÃ©neros"}),e.jsx("th",{className:"border px-2 py-1",children:"Imagen"}),e.jsx("th",{className:"border px-2 py-1",children:"Acciones"})]})}),e.jsx("tbody",{children:d.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1",children:e.jsx("input",{type:"checkbox",checked:j.includes(a.id),onChange:k=>{k.target.checked?m(z=>[...z,a.id]):m(z=>z.filter(D=>D!==a.id))}})}),e.jsx("td",{className:"border px-2 py-1",children:a.id}),e.jsx("td",{className:"border px-2 py-1",children:e.jsx("a",{href:`#/detalle/${a.media_type}/${a.id}`,className:"text-blue-700 underline hover:text-blue-900",target:"_blank",rel:"noopener noreferrer",children:a.nombre||e.jsx("span",{className:"text-gray-400 italic",children:"Sin nombre"})})}),e.jsx("td",{className:"border px-2 py-1",children:a.tipo}),e.jsx("td",{className:"border px-2 py-1",children:a.anio}),e.jsx("td",{className:"border px-2 py-1",children:a.finalizada?"SÃ­":"No"}),e.jsx("td",{className:"border px-2 py-1",children:E(a.ultima_actualizacion)}),e.jsx("td",{className:"border px-2 py-1",children:a.nombre_original}),e.jsx("td",{className:"border px-2 py-1",children:a.puntuacion??"-"}),e.jsx("td",{className:"border px-2 py-1",children:Array.isArray(a.generos)?a.generos.join(", "):typeof a.generos=="string"?a.generos:"-"}),e.jsx("td",{className:"border px-2 py-1",children:a.imagen&&e.jsx("img",{src:a.imagen,alt:a.nombre||"miniatura",style:{width:40,borderRadius:4,objectFit:"cover"}})}),e.jsx("td",{className:"border px-2 py-1",children:e.jsx("button",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded hover:bg-blue-200",onClick:()=>u(a.id),title:"Recalcular tipo",children:"Recalcular tipo"})})]},a.id))})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-2 my-4",children:[e.jsxs("span",{children:["Mostrando"," ",d.length===0?0:(g-1)*d.length+1,"-",Math.min(g*d.length,s.length)," de"," ",s.length," resultados"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 rounded bg-gray-200 hover:bg-gray-300",onClick:()=>w(a=>Math.max(1,a-1)),disabled:g===1,"aria-label":"PÃ¡gina anterior",children:"Anterior"}),e.jsxs("span",{children:["PÃ¡gina"," ",e.jsx("input",{type:"number",min:1,max:b,value:g,onChange:a=>{let k=Number(a.target.value);(isNaN(k)||k<1)&&(k=1),k>b&&(k=b),w(k)},className:"w-12 text-center border rounded","aria-label":"NÃºmero de pÃ¡gina"})," ","de ",b]}),e.jsx("button",{className:"px-2 py-1 rounded bg-gray-200 hover:bg-gray-300",onClick:()=>w(a=>Math.min(b,a+1)),disabled:g===b,"aria-label":"PÃ¡gina siguiente",children:"Siguiente"})]})]})]})}function Q({usuarios:s,loading:l,sortBy:p,sortDir:x,handleSort:r,sortIcon:t,handleEliminar:h}){return l?e.jsx("p",{children:"Cargando usuarios..."}):e.jsxs("table",{className:"w-full table-auto border-collapse text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>r("user_id"),children:["ID",t("user_id")]}),e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>r("nick"),children:["Nick",t("nick")]}),e.jsx("th",{className:"border px-2 py-1",children:"Avatar"}),e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>r("rol"),children:["Rol",t("rol")]}),e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>r("comparte_catalogo"),children:["Comparte catÃ¡logo",t("comparte_catalogo")]}),e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>r("plan"),children:["Plan",t("plan")]}),e.jsx("th",{className:"border px-2 py-1",children:"Acciones"})]})}),e.jsx("tbody",{children:s.map(n=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1",children:n.user_id}),e.jsx("td",{className:"border px-2 py-1",children:n.nick||e.jsx("span",{className:"text-gray-400 italic",children:"Sin nick"})}),e.jsx("td",{className:"border px-2 py-1",children:n.avatar?e.jsx("img",{src:n.avatar,alt:"avatar",className:"w-8 h-8 rounded-full object-cover border"}):e.jsx("span",{className:"text-gray-400 italic",children:"Sin avatar"})}),e.jsx("td",{className:"border px-2 py-1",children:n.rol}),e.jsx("td",{className:"border px-2 py-1 text-center",children:n.comparte_catalogo?"SÃ­":"No"}),e.jsx("td",{className:"border px-2 py-1",children:n.plan||e.jsx("span",{className:"text-gray-400 italic",children:"-"})}),e.jsx("td",{className:"border px-2 py-1 space-x-2",children:e.jsx("button",{onClick:()=>h(n.user_id),className:"text-sm bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700",children:"Borrar usuario"})})]},n.user_id))})]})}function V({migrandoDuraciones:s,migrandoGeneros:l,handleMigrarDuraciones:p,handleMigrarGeneros:x,resultadoMigracion:r,resultadoMigracionGeneros:t,logsMigracion:h}){return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"mt-8 p-6 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-yellow-800",children:"ðŸš€ MigraciÃ³n de Datos"}),s&&e.jsxs("div",{className:"flex items-center gap-2 text-yellow-700",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-yellow-600"}),e.jsx("span",{className:"text-sm",children:"Procesando..."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-800 mb-2",children:"Actualizar Duraciones de Episodios"}),e.jsx("p",{className:"text-sm text-yellow-700 mb-3",children:"Actualiza las duraciones de todos los episodios existentes desde TMDb. Esto puede tardar varios minutos dependiendo del nÃºmero de series."}),e.jsx("button",{onClick:p,disabled:s,className:`px-4 py-2 text-white rounded font-medium transition-colors ${s?"bg-gray-400 cursor-not-allowed":"bg-yellow-600 hover:bg-yellow-700"}`,children:s?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-pulse mr-2",children:"â³"}),"Migrando duraciones..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2",children:"â±ï¸"}),"Migrar Duraciones"]})})]}),r&&e.jsxs("div",{className:`p-4 rounded-lg ${r.error?"bg-red-50 border border-red-200":"bg-green-50 border border-green-200"}`,children:[e.jsx("h4",{className:`font-semibold mb-2 ${r.error?"text-red-800":"text-green-800"}`,children:r.error?"âŒ Error en la migraciÃ³n":"âœ… MigraciÃ³n completada"}),r.error?e.jsx("p",{className:"text-red-700 text-sm",children:r.error}):e.jsxs("div",{className:"text-green-700 text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Total de series procesadas:"})," ",r.total]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Actualizaciones exitosas:"})," ",r.exitosos]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Errores:"})," ",r.fallidos]}),r.fallidos>0&&e.jsx("p",{className:"text-yellow-600",children:"âš ï¸ Revisa la consola para ver detalles de los errores"})]})]}),e.jsxs("div",{className:"text-xs text-yellow-600 space-y-1",children:[e.jsx("p",{children:"â€¢ Esta operaciÃ³n consultarÃ¡ la API de TMDb para cada serie"}),e.jsx("p",{children:"â€¢ Se aplicarÃ¡ un retraso de 250ms entre consultas para respetar los lÃ­mites de la API"}),e.jsx("p",{children:"â€¢ Los logs detallados se mostrarÃ¡n en la consola del navegador"})]})]})]}),e.jsxs("section",{className:"mt-8 p-6 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-green-800",children:"ðŸŽ­ MigraciÃ³n de GÃ©neros"}),l&&e.jsxs("div",{className:"flex items-center gap-2 text-green-700",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600"}),e.jsx("span",{className:"text-sm",children:"Procesando..."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-green-800 mb-2",children:"Actualizar GÃ©neros desde TMDb"}),e.jsx("p",{className:"text-sm text-green-700 mb-3",children:"Actualiza los gÃ©neros de todo el contenido que no tenga gÃ©neros asignados desde TMDb."}),e.jsx("button",{onClick:x,disabled:l,className:`px-4 py-2 text-white rounded font-medium transition-colors ${l?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-pulse mr-2",children:"â³"}),"Migrando gÃ©neros..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2",children:"ðŸŽ­"}),"Migrar GÃ©neros"]})})]}),t&&e.jsxs("div",{className:`p-4 rounded-lg ${t.error?"bg-red-50 border border-red-200":"bg-green-50 border border-green-200"}`,children:[e.jsx("h4",{className:`font-semibold mb-2 ${t.error?"text-red-800":"text-green-800"}`,children:t.error?"âŒ Error en la migraciÃ³n":"âœ… MigraciÃ³n completada"}),t.error?e.jsx("p",{className:"text-red-700 text-sm",children:t.error}):e.jsxs("div",{className:"text-green-700 text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Total de elementos procesados:"})," ",t.total]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Actualizaciones exitosas:"})," ",t.exitosos]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Errores:"})," ",t.fallidos]}),t.noEncontrados>0&&e.jsxs("p",{children:[e.jsx("strong",{children:"No encontrados en TMDb:"})," ",e.jsx("span",{className:"text-yellow-600",children:t.noEncontrados})]}),(t.fallidos>0||t.noEncontrados>0)&&e.jsx("p",{className:"text-yellow-600 mt-2",children:"âš ï¸ Revisa la consola para ver detalles"})]})]})]})]}),h&&h.length>0&&e.jsx("div",{className:"bg-gray-900 text-green-200 p-2 mt-2 rounded max-h-40 overflow-y-auto text-xs",children:h.map((n,f)=>e.jsx("div",{children:n},f))})]})}const F={emoji:"ðŸ†",nombre:"Logro de Ejemplo",descripcion:"Has desbloqueado un logro de prueba."};function W({usuarios:s,onNotificacionEnviada:l,series:p=[]}){const[x,r]=i.useState(""),[t,h]=i.useState(""),[n,f]=i.useState(""),[g,w]=i.useState(""),[b,d]=i.useState(""),[j,m]=i.useState(""),S=(s||[]).map(c=>e.jsxs("option",{value:c.user_id,children:[c.nick?c.nick:c.user_id," ",c.rol?`(${c.rol})`:""]},c.user_id)),o=[e.jsx("option",{value:"",children:"Sin imagen de serie"},""),...(p||[]).map(c=>e.jsxs("option",{value:c.id,children:[c.nombre," (",c.id,")"]},c.id))],y=async c=>{if(c.preventDefault(),!x){m("Debes seleccionar un usuario.");return}m("Enviando...");let _=null;if(b){const u=p.find(a=>String(a.id)===String(b));_=(u==null?void 0:u.imagen)||null}const{error:E}=await A.from("notificaciones_usuario").insert([{user_id:x,titulo:t,mensaje:n,url:g,imagen:_}]);E?m("Error al enviar: "+E.message):(m("Â¡NotificaciÃ³n enviada!"),h(""),f(""),w(""),r(""),d(""),l&&l())},N=async()=>{if(!x){m("Selecciona un usuario para simular el logro.");return}m("Enviando notificaciÃ³n de logro...");const{error:c}=await A.from("notificaciones_usuario").insert([{user_id:x,titulo:"Â¡Nuevo logro desbloqueado!",mensaje:`${F.emoji} ${F.nombre}: ${F.descripcion}`,url:"/perfil#logros",imagen:"ðŸŽ‰"}]);c?m("Error al enviar: "+c.message):(m("Â¡NotificaciÃ³n de logro enviada!"),l&&l())};return e.jsxs("div",{className:"max-w-md mx-auto my-8 p-4 bg-white rounded shadow",children:[e.jsx("h2",{className:"font-bold mb-2",children:"Enviar notificaciÃ³n"}),e.jsxs("form",{onSubmit:y,className:"flex flex-col gap-2",children:[e.jsxs("select",{value:x,onChange:c=>r(c.target.value),className:"border px-2 py-1 rounded",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona usuario"}),S]}),e.jsx("input",{type:"text",placeholder:"TÃ­tulo",value:t,onChange:c=>h(c.target.value),className:"border px-2 py-1 rounded",required:!0}),e.jsx("input",{type:"text",placeholder:"Mensaje",value:n,onChange:c=>f(c.target.value),className:"border px-2 py-1 rounded",required:!0}),e.jsx("input",{type:"text",placeholder:"URL destino (opcional)",value:g,onChange:c=>w(c.target.value),className:"border px-2 py-1 rounded"}),e.jsx("select",{value:b,onChange:c=>d(c.target.value),className:"border px-2 py-1 rounded",children:o}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700",children:"Enviar notificaciÃ³n"})]}),e.jsx("button",{className:"mt-3 bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 w-full",onClick:N,type:"button",children:"Simular notificaciÃ³n de logro"}),j&&e.jsx("div",{className:"mt-2 text-sm",children:j})]})}function X({usuarios:s}){const[l,p]=i.useState(""),[x,r]=i.useState([]),[t,h]=i.useState(!1),[n,f]=i.useState({nombre:"",descripcion:"",emoji:""}),[g,w]=i.useState(null),[b,d]=i.useState("");i.useEffect(()=>{if(!l){r([]);return}h(!0),A.from("logros_usuario").select("*").eq("user_id",l).then(({data:o,error:y})=>{y&&d("Error cargando logros"),r(o||[]),h(!1)})},[l]);const j=async o=>{if(o.preventDefault(),h(!0),g){const{error:N}=await A.from("logros_usuario").update(n).eq("id",g);d(N?"Error modificando logro":"Logro modificado")}else{const{error:N}=await A.from("logros_usuario").insert([{...n,user_id:l}]);d(N?"Error aÃ±adiendo logro":"Logro aÃ±adido")}f({nombre:"",descripcion:"",emoji:""}),w(null);const{data:y}=await A.from("logros_usuario").select("*").eq("user_id",l);r(y||[]),h(!1)},m=async o=>{window.confirm("Â¿Eliminar este logro?")&&(h(!0),await A.from("logros_usuario").delete().eq("id",o),r(y=>y.filter(N=>N.id!==o)),d("Logro eliminado"),h(!1))},S=o=>{f({nombre:o.nombre,descripcion:o.descripcion,emoji:o.emoji}),w(o.id)};return e.jsxs("div",{className:"bg-white rounded shadow p-6 max-w-2xl mx-auto my-8",children:[e.jsx("h2",{className:"font-bold mb-4 text-lg",children:"GestiÃ³n de logros de usuario"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Selecciona usuario"}),e.jsxs("select",{value:l,onChange:o=>p(o.target.value),className:"border px-2 py-1 rounded w-full",children:[e.jsx("option",{value:"",children:"-- Selecciona usuario --"}),(s||[]).map(o=>e.jsx("option",{value:o.user_id,children:o.nick||o.user_id},o.user_id))]})]}),l&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Logros actuales"}),t?e.jsx("p",{children:"Cargando logros..."}):e.jsxs("ul",{className:"mb-4 space-y-2",children:[x.length===0&&e.jsx("li",{className:"text-gray-500 italic",children:"Sin logros"}),x.map(o=>e.jsxs("li",{className:"flex items-center gap-2 border-b pb-1",children:[e.jsx("span",{className:"text-xl",children:o.emoji}),e.jsx("span",{className:"font-medium",children:o.nombre}),e.jsx("span",{className:"text-gray-600 text-sm",children:o.descripcion}),e.jsx("button",{className:"ml-auto text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200",onClick:()=>S(o),children:"Editar"}),e.jsx("button",{className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded hover:bg-red-200",onClick:()=>m(o.id),children:"Eliminar"})]},o.id))]}),e.jsxs("form",{onSubmit:j,className:"flex flex-col gap-2 border-t pt-4 mt-4",children:[e.jsx("h4",{className:"font-semibold",children:g?"Modificar logro":"AÃ±adir logro"}),e.jsx("input",{type:"text",placeholder:"Nombre",value:n.nombre,onChange:o=>f(y=>({...y,nombre:o.target.value})),className:"border px-2 py-1 rounded",required:!0}),e.jsx("input",{type:"text",placeholder:"DescripciÃ³n",value:n.descripcion,onChange:o=>f(y=>({...y,descripcion:o.target.value})),className:"border px-2 py-1 rounded",required:!0}),e.jsx("input",{type:"text",placeholder:"Emoji",value:n.emoji,onChange:o=>f(y=>({...y,emoji:o.target.value})),className:"border px-2 py-1 rounded w-24",required:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700",disabled:t,children:g?"Guardar cambios":"AÃ±adir logro"}),g&&e.jsx("button",{type:"button",className:"bg-gray-300 text-gray-800 px-3 py-1 rounded hover:bg-gray-400",onClick:()=>{w(null),f({nombre:"",descripcion:"",emoji:""})},children:"Cancelar"})]})]})]}),b&&e.jsx("div",{className:"mt-4 text-sm text-blue-700",children:b})]})}function Y(s){return s?new Date(s).toLocaleDateString():"-"}function Z(s){const[l,p]=i.useState([]),[x,r]=i.useState(!0),[t,h]=i.useState(""),[n,f]=i.useState(""),[g,w]=i.useState(""),[b,d]=i.useState(1),j=20,[m,S]=i.useState("id"),[o,y]=i.useState("asc"),[N,c]=i.useState([]),[_,E]=i.useState("");i.useEffect(()=>{async function v(){r(!0);let C=A.from("contenido").select("id, nombre, tipo, media_type, anio, finalizada, ultima_actualizacion, nombre_original, puntuacion, generos, imagen, sinopsis, duracion, temporadas, episodios_totales").order(m,{ascending:o==="asc"});n&&(C=C.eq("tipo",n));const{data:q,error:R}=await C;R?(s==null||s("Error cargando contenidos"),p([])):p(q||[]),r(!1)}v()},[n,m,o,s]);const u=i.useMemo(()=>{let v=l;return t&&(v=v.filter(C=>(C.nombre||"").toLowerCase().includes(t.toLowerCase()))),g&&(v=v.filter(C=>String(C.id).includes(g))),v},[l,t,g]),a=Math.max(1,Math.ceil(u.length/j)),k=i.useMemo(()=>u.slice((b-1)*j,b*j),[u,b,j]),z=i.useMemo(()=>{const v=new Set(l.map(C=>C.tipo).filter(Boolean));return Array.from(v)},[l]);function D(v){m===v?y(C=>C==="asc"?"desc":"asc"):(S(v),y("asc"))}function B(v){return m!==v?null:o==="asc"?" â–²":" â–¼"}async function I(){if(_==="borrar"){if(!window.confirm("Â¿Seguro que quieres borrar los seleccionados?"))return;r(!0);const{error:v}=await A.from("contenido").delete().in("id",N);v?s==null||s("Error al borrar contenidos"):(s==null||s("Contenidos borrados correctamente"),p(C=>C.filter(q=>!N.includes(q.id))),c([])),r(!1)}}async function U(v){s==null||s(`Recalcular tipo para ID ${v} (no implementado)`)}return{contenidos:l,loading:x,tiposDisponibles:z,busqueda:t,setBusqueda:h,filtroTipo:n,setFiltroTipo:f,busquedaId:g,setBusquedaId:w,pagina:b,setPagina:d,totalPaginas:a,contenidosPagina:k,seleccionados:N,setSeleccionados:c,accionBatch:_,setAccionBatch:E,handleBatchAction:I,handleSort:D,sortBy:m,sortIcon:B,formatearFecha:Y,handleRecalcularTipo:U,contenidosFiltrados:u}}function G(s){const[l,p]=i.useState([]),[x,r]=i.useState(!0),[t,h]=i.useState("user_id"),[n,f]=i.useState("asc");i.useEffect(()=>{async function d(){r(!0);let j=A.from("usuarios").select("user_id, nick, avatar, rol, comparte_catalogo, plan").order(t,{ascending:n==="asc"});const{data:m,error:S}=await j;S?(s==null||s("Error cargando usuarios"),p([])):p(m||[]),r(!1)}d()},[t,n,s]);function g(d){t===d?f(j=>j==="asc"?"desc":"asc"):(h(d),f("asc"))}function w(d){return t!==d?null:n==="asc"?" â–²":" â–¼"}async function b(d){if(!window.confirm("Â¿Seguro que quieres borrar este usuario?"))return;r(!0);const{error:j}=await A.from("usuarios").delete().eq("user_id",d);j?s==null||s("Error al borrar usuario"):(s==null||s("Usuario borrado correctamente"),p(m=>m.filter(S=>S.user_id!==d))),r(!1)}return{usuarios:l,loading:x,sortBy:t,sortDir:n,handleSort:g,sortIcon:w,handleEliminar:b}}const T=[{key:"contenidos",label:"ðŸ“º Contenidos"},{key:"migracion",label:"ðŸ”„ Migraciones"},{key:"notificaciones",label:"ðŸ”” Notificaciones"},{key:"usuarios",label:"ðŸ‘¥ Usuarios"},{key:"logros",label:"ðŸ† Logros usuario"}];function oe(){var E;const[s,l]=i.useState("contenidos"),[p,x]=i.useState(""),r=O(),{esAdmin:t,loading:h}=H();i.useEffect(()=>{!h&&!t&&r("/")},[t,h,r]);const n=Z(x),f=G(x),[g,w]=i.useState(!1),[b,d]=i.useState(!1),[j,m]=i.useState(null),[S,o]=i.useState(null),[y,N]=i.useState([]),c=async()=>{w(!0),m(null),x("Iniciando migraciÃ³n de duraciones...");try{const u={exitosos:10,fallidos:2,total:12};m(u),x(`âœ… MigraciÃ³n completada: ${u.exitosos} exitosos, ${u.fallidos} fallidos de ${u.total} elementos`)}catch(u){x("âŒ Error durante la migraciÃ³n"),m({error:u.message})}finally{w(!1)}},_=async()=>{d(!0),o(null),x("Iniciando migraciÃ³n de gÃ©neros...");try{const u={exitosos:20,fallidos:1,total:21,noEncontrados:0};o(u),x(`âœ… MigraciÃ³n de gÃ©neros completada: ${u.exitosos} exitosos, ${u.fallidos} fallidos de ${u.total} elementos`)}catch(u){x("âŒ Error durante la migraciÃ³n de gÃ©neros"),o({error:u.message})}finally{d(!1)}};return h?e.jsxs(e.Fragment,{children:[e.jsx($,{}),e.jsx("main",{className:"pt-20 px-4 w-full h-[80vh] flex items-center justify-center",children:e.jsx("p",{className:"text-center text-lg",children:"Cargando..."})}),e.jsx(L,{})]}):t?e.jsxs(e.Fragment,{children:[e.jsx($,{}),e.jsx(P,{texto:p}),e.jsxs("main",{className:"pt-20 px-0 w-full h-[calc(100vh-80px)] flex flex-row gap-0",children:[e.jsx("aside",{className:"w-56 shrink-0 h-full bg-gray-50 border-r border-gray-200 flex flex-col",children:e.jsx("nav",{className:"flex flex-col gap-2 py-8 px-4 sticky top-24",children:T.map(u=>e.jsx("button",{onClick:()=>l(u.key),className:`text-left px-4 py-2 rounded font-medium transition-all ${s===u.key?"bg-blue-600 text-white shadow":"bg-gray-100 text-gray-700 hover:bg-blue-100"}`,children:u.label},u.key))})}),e.jsxs("section",{className:"flex-1 min-w-0 h-full overflow-auto px-8 py-8 flex flex-col",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:(E=T.find(u=>u.key===s))==null?void 0:E.label}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[s==="contenidos"&&e.jsx(K,{...n}),s==="usuarios"&&e.jsx(Q,{...f}),s==="migracion"&&e.jsx(V,{migrandoDuraciones:g,migrandoGeneros:b,handleMigrarDuraciones:c,handleMigrarGeneros:_,resultadoMigracion:j,resultadoMigracionGeneros:S,logsMigracion:y}),s==="notificaciones"&&e.jsx(W,{setMensaje:x}),s==="logros"&&e.jsx(X,{usuarios:f.usuarios})]})]})]}),e.jsx(L,{})]}):null}export{oe as default};

import{r as c}from"./index-B5isPGjJ.js";import{s as i}from"./useUsuario-ByIR5A8c.js";function T(e){const[w,n]=c.useState([]),[x,t]=c.useState(!1);return c.useEffect(()=>{if(!(e!=null&&e.id)){n([]);return}(async()=>{var S,h;t(!0);const s=new Date,b=s.toISOString().split("T")[0],m=new Date(s);m.setDate(s.getDate()+90);const D=m.toISOString().split("T")[0],{data:E,error:f}=await i.from("catalogo_usuario").select("contenido_id").eq("user_id",e.id).in("estado",["viendo","pendiente","vista"]);if(f){console.error("Error cargando catálogo del usuario:",f),t(!1);return}const l=E.map(o=>o.contenido_id);if(l.length===0){n([]),t(!1);return}const{data:y,error:p}=await i.from("episodios").select("id, temporada, episodio, fecha_emision, nombre, contenido_id, imagen").in("contenido_id",l).gte("fecha_emision",b).lte("fecha_emision",D).order("fecha_emision",{ascending:!0}).order("temporada",{ascending:!0}).order("episodio",{ascending:!0});if(p){console.error("Error cargando episodios:",p),t(!1);return}const{data:r}=await i.from("episodios_vistos").select("episodio_id").eq("user_id",e.id),q=(r==null?void 0:r.map(o=>o.episodio_id))||[],g=y.filter(o=>!q.includes(o.id)),_=[...new Set(g.map(o=>o.contenido_id))];let u={};if(_.length>0){const{data:o}=await i.from("contenido").select("id, contenido_traducciones(nombre, idioma)").in("id",_);if(o)for(const a of o){const d=((S=a.contenido_traducciones)==null?void 0:S.find(C=>C.idioma==="es"))||((h=a.contenido_traducciones)==null?void 0:h[0]);u[a.id]=(d==null?void 0:d.nombre)||"Sin título"}}const v=g.map(o=>({...o,contenido_nombre:u[o.contenido_id]||"Sin título"}));n(v),t(!1)})()},[e]),{proximos:w,loading:x}}export{T as u};

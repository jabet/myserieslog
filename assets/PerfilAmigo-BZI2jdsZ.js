import{b as V,a as z,r as i,j as o}from"./index-B3ie1F2B.js";import{s as n}from"./useUsuario-DqHBhlC3.js";import{N as B}from"./Navbar-CXPgFggP.js";import{M as G}from"./MediaCard-Bg9Z-YRL.js";import{F as H}from"./Footer-BLSME1uV.js";import"./index-CZ0-wQBk.js";function X(){const{nick:g}=V(),k=z(),[d,A]=i.useState(null),[p,F]=i.useState(null),[f,M]=i.useState("es"),[x,_]=i.useState(!1),[m,b]=i.useState([]),[c,s]=i.useState(!0),[j,r]=i.useState("");return i.useEffect(()=>{n.auth.getUser().then(async({data:{user:e}})=>{if(!e)return;A(e);const{data:t}=await n.from("preferencias_usuario").select("idioma_preferido").eq("user_id",e.id).single();t!=null&&t.idioma_preferido&&M(t.idioma_preferido)})},[]),i.useEffect(()=>{if(!d)return;(async()=>{s(!0),r(""),_(!1),b([]);const{data:t,error:U}=await n.from("usuarios").select("user_id, nick, avatar").eq("nick",g).single();if(U||!t){r("Usuario no encontrado."),s(!1);return}F(t);const l=t.user_id,{data:u}=await n.from("amistades").select("estado, comparte_catalogo").or(`and(usuario1.eq.${d.id},usuario2.eq.${l}),and(usuario1.eq.${l},usuario2.eq.${d.id})`).maybeSingle();if(!u||u.estado!=="aceptada"){r("No sois amigos."),s(!1);return}if(!u.comparte_catalogo){r("Este usuario no comparte su catálogo."),s(!1);return}_(!0);const{data:I,error:h}=await n.from("catalogo_usuario").select(`
          contenido_id,
          contenido:contenido (
            id,
            imagen,
            tipo,
            media_type,
            nombre,
            anio,
            contenido_traducciones!contenido_id(idioma, nombre, sinopsis)
          )
        `).eq("user_id",l);if(h){console.error("Error cargando catálogo amigo:",h),r("No se pudo cargar el catálogo."),s(!1);return}const D=(I||[]).map((a,L)=>{var S,y,$,q,C,v,E,P,w;const N=((y=(S=a.contenido)==null?void 0:S.contenido_traducciones)==null?void 0:y.find(R=>R.idioma===f))||{};return{id:(($=a.contenido)==null?void 0:$.id)??a.contenido_id??`sin_id_${L}`,nombre:N.nombre||((q=a.contenido)==null?void 0:q.nombre)||"Sin título",sinopsis:N.sinopsis||"Sin información disponible.",imagen:(C=a.contenido)==null?void 0:C.imagen,anio:(v=a.contenido)==null?void 0:v.anio,tipo:(E=a.contenido)==null?void 0:E.tipo,media_type:((P=a.contenido)==null?void 0:P.media_type)||((w=a.contenido)==null?void 0:w.tipo)||"movie"}});b(D),s(!1)})()},[d,g,f]),o.jsxs(o.Fragment,{children:[o.jsx(B,{}),o.jsxs("main",{className:"pt-20 px-4 max-w-4xl mx-auto",children:[o.jsx("h1",{className:"text-2xl font-bold mb-4",children:p?`Catálogo de ${p.nick}`:"Catálogo de usuario"}),c&&o.jsx("p",{children:"Cargando catálogo..."}),!c&&j&&o.jsx("p",{className:"text-red-600 mb-4",children:j}),!c&&x&&m.length===0&&o.jsx("p",{className:"text-gray-600",children:"No hay contenidos en su catálogo."}),!c&&x&&m.length>0&&o.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:m.map(e=>o.jsx(G,{nombre:e.nombre,imagen:e.imagen,anio:e.anio,tipo:e.tipo,onVerDetalle:()=>k(`/detalle/${e.media_type}/${e.id}`)},e.id))})]}),o.jsx(H,{})]})}export{X as default};

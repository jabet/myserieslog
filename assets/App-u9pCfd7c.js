const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FiltrosCatalogo-DmD5sWeO.js","assets/index-XnMTmJ1N.js","assets/index-YqX8kaJ9.css","assets/index-BdQq_4o_.js","assets/Navbar-Brd59B00.js","assets/useUsuario-DUZRc8QX.js","assets/index-BF7s0iee.js","assets/CatalogoGrid-D2g4zJr4.js","assets/MediaCard-BKFSabxf.js","assets/index-DakWXJf2.js","assets/ProximasEmisiones-DuklkOVb.js"])))=>i.map(i=>d[i]);
import{r as o,j as s,_ as w}from"./index-XnMTmJ1N.js";import{N as k}from"./Navbar-Brd59B00.js";import{F as A}from"./Footer-C0KuTKYv.js";import{u as F}from"./useCatalogoUsuario-CycOQxes.js";import{u as I}from"./useProximasEmisiones-iBaZMEdz.js";import{s as L,u as O}from"./useUsuario-DUZRc8QX.js";function R(a){const[n,i]=o.useState([]),[u,d]=o.useState(!1);return o.useEffect(()=>{if(!(a!=null&&a.id)){i([]);return}(async()=>{d(!0);try{const{data:r,error:h}=await L.from("proximo_episodio_usuario").select(`
            contenido_id,
            temporada,
            episodio,
            episodios (
              id,
              nombre,
              fecha_emision
            )
          `).eq("user_id",a.id);h?(console.error("Error cargando próximos episodios:",h),i([])):(i(r||[]),console.log("Próximos episodios cargados:",(r==null?void 0:r.length)||0))}catch(r){console.error("Error en cargarProximosEpisodios:",r),i([])}finally{d(!1)}})()},[a==null?void 0:a.id]),{proximosEpisodios:n,loading:u}}const z=o.lazy(()=>w(()=>import("./FiltrosCatalogo-DmD5sWeO.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),N=o.lazy(()=>w(()=>import("./CatalogoGrid-D2g4zJr4.js"),__vite__mapDeps([7,1,2,8,9,4,5]))),Q=o.lazy(()=>w(()=>import("./ProximasEmisiones-DuklkOVb.js"),__vite__mapDeps([10,1,2])));function H(){const{usuario:a,idioma:n}=O(),{catalogo:i,tiposDisponibles:u,aniosDisponibles:d,estadosDisponibles:y,aplicarFiltros:r,loading:h}=F(a,n),{proximos:x,loading:E}=I(a),{proximosEpisodios:P}=R(a),M=o.useMemo(()=>new Date().toISOString().slice(0,10),[]),t=o.useMemo(()=>new Set(x.map(e=>e.contenido_id)),[x]),g=o.useMemo(()=>i.filter(e=>t.has(e.id)).map(e=>{const b=x.filter(l=>l.contenido_id===e.id).filter(l=>l.fecha_emision>=M).sort((l,V)=>l.fecha_emision.localeCompare(V.fecha_emision))[0];return{...e,conProximos:!0,proximoEpisodio:b}}),[i,t,x,M]),S=o.useMemo(()=>new Map(P.map(e=>{var p,b,l;return[e.contenido_id,{temporada:e.temporada,episodio:e.episodio,nombre:(p=e.episodios)==null?void 0:p.nombre,fecha_emision:(b=e.episodios)==null?void 0:b.fecha_emision,id:(l=e.episodios)==null?void 0:l.id}]})),[P]),c=o.useDeferredValue(o.useMemo(()=>i.filter(e=>e.estado==="viendo"&&!t.has(e.id)).map(e=>{const p=S.get(e.id)||null;return{...e,proximoEpisodio:p}}),[i,t,S])),f=o.useMemo(()=>new Set(c.map(e=>e.id)),[c]),m=o.useDeferredValue(o.useMemo(()=>i.filter(e=>e.estado==="pendiente"&&!t.has(e.id)&&!f.has(e.id)),[i,t,f])),C=o.useMemo(()=>new Set(m.map(e=>e.id)),[m]),j=o.useDeferredValue(o.useMemo(()=>i.filter(e=>!t.has(e.id)&&!f.has(e.id)&&!C.has(e.id)),[i,t,f,C]));return s.jsxs("div",{className:"min-h-screen flex flex-col grid-rows-[auto_1fr_auto]",children:[s.jsx(k,{}),s.jsx("main",{className:"flex-1 pt-20 px-4",children:s.jsxs("div",{className:"flex flex-col md:flex-row gap-8 max-w-7xl mx-auto",children:[s.jsxs("div",{className:"flex-1 min-w-0 order-2 md:order-none",children:[s.jsx(o.Suspense,{fallback:s.jsx("div",{children:"Cargando filtros..."}),children:s.jsx(z,{tipos:u,anios:d,estados:y,onFiltrar:r})}),h?s.jsxs("div",{className:"space-y-8",children:[s.jsx(v,{title:"Nuevos capítulos",items:5}),s.jsx(v,{title:"Continuar viendo",items:4}),s.jsx(v,{title:"Quiero ver",items:3}),s.jsx(v,{title:"Mi catálogo",items:8})]}):s.jsxs("div",{className:"space-y-8",children:[s.jsxs(_,{show:g.length>0,hasContent:g.length>0,children:[s.jsxs("h2",{className:"text-xl font-bold mb-2 flex items-center gap-2",children:[s.jsx("span",{children:"Novedades"}),s.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full",children:g.length})]}),s.jsx(N,{catalogo:g,className:"lg:min-h-80"})]}),s.jsxs(_,{show:c.length>0,hasContent:c.length>0,children:[s.jsxs("h2",{className:"text-xl font-bold mb-2 flex items-center gap-2",children:[s.jsx("span",{children:"Continuar viendo"}),s.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full",children:c.length})]}),s.jsx(N,{catalogo:c})]}),s.jsxs(_,{show:m.length>0,hasContent:m.length>0,children:[s.jsxs("h2",{className:"text-xl font-bold mb-2 flex items-center gap-2",children:[s.jsx("span",{children:"Quiero ver"}),s.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full",children:m.length})]}),s.jsx(N,{catalogo:m,className:"lg:h-44"})]}),s.jsxs(_,{show:j.length>0,hasContent:j.length>0,children:[s.jsxs("h2",{className:"text-xl font-bold mb-2",children:[s.jsx("span",{children:"Mi catálogo"})," ",s.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full",children:j.length})]}),s.jsx(N,{catalogo:j})]})]})]}),s.jsx("aside",{className:"w-full md:w-80 shrink-0 order-1 md:order-none mb-8 md:mb-0",children:E?s.jsx(D,{}):s.jsx(o.Suspense,{fallback:s.jsx(D,{}),children:s.jsx(Q,{emisiones:x,loading:E})})})]})}),s.jsx(A,{})]})}function v({title:a,items:n}){const i={"Nuevos capítulos":"w-48","Continuar viendo":"w-44","Quiero ver":"w-36","Mi catálogo":"w-32"};return s.jsxs("section",{className:"mb-8",children:[s.jsx("div",{className:`h-7 ${i[a]||"w-40"} bg-gray-200 rounded animate-pulse mb-4`}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:[...Array(n)].map((u,d)=>s.jsx("div",{className:"group cursor-pointer",children:s.jsxs("div",{className:"relative overflow-hidden rounded-lg shadow-md bg-white",children:[s.jsx("div",{className:"aspect-[2/3] bg-gray-200 animate-pulse"}),s.jsxs("div",{className:"p-3 space-y-2",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"}),s.jsx("div",{className:"h-3 bg-gray-100 rounded animate-pulse w-1/2"}),s.jsx("div",{className:"h-3 bg-gray-100 rounded animate-pulse w-3/4"})]})]})},d))})]})}function _({show:a,hasContent:n,children:i}){return n?s.jsx("section",{className:`mb-8 transition-all duration-500 ${a?"opacity-100 transform translate-y-0":"opacity-0 transform translate-y-4"}`,children:i}):null}function D(){return s.jsxs("aside",{className:"w-full md:w-80 shrink-0 mb-8",children:[s.jsx("div",{className:"h-6 w-40 bg-gray-200 rounded animate-pulse mb-4"}),s.jsx("ul",{className:"space-y-4",children:[...Array(5)].map((a,n)=>s.jsxs("li",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-16 bg-gray-200 rounded-lg animate-pulse"}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-3/4"}),s.jsx("div",{className:"h-3 bg-gray-100 rounded animate-pulse w-1/2"}),s.jsx("div",{className:"h-3 bg-gray-100 rounded animate-pulse w-1/3"})]})]},n))})]})}export{H as default};

import{r as m,j as e}from"./index-B5isPGjJ.js";import{s as f,u as De}from"./useUsuario-ByIR5A8c.js";import{M as Z,g as Ce,d as ke}from"./guardarContenidoTMDB-Dj0ljdgS.js";import{N as ee}from"./Navbar-CKa8b93H.js";import{F as ae}from"./Footer-KUXXIXDs.js";const Pe="b0d797f053110a25f57317b8e7ba3b06",qe="https://api.themoviedb.org/3";async function Be(s){try{const g=await(await fetch(`${qe}/tv/${s}/translations?api_key=${Pe}`)).json();if(!g.translations)return!1;const p=g.translations.map(l=>{var i,d;return{contenido_id:s,idioma:l.iso_639_1,nombre:((i=l.data)==null?void 0:i.name)||"",sinopsis:((d=l.data)==null?void 0:d.overview)||""}}),n=Object.values(p.reduce((l,i)=>(l[i.idioma]||(l[i.idioma]=i),l),{}));if(n.length>0){const{error:l}=await f.from("contenido_traducciones").upsert(n,{onConflict:"contenido_id,idioma"});if(l)return console.error("Error upsert traducciones:",l),!1}return!0}catch(t){return console.error("Error en actualizarTraducciones:",t),!1}}const oe="b0d797f053110a25f57317b8e7ba3b06",re="https://api.themoviedb.org/3";async function se(s,t="es-ES"){try{console.log(`Cargando temporadas para serie ${s}...`);const p=await(await fetch(`${re}/tv/${s}?api_key=${oe}&language=${t}`)).json();if(!p.seasons)return!1;const n=[];for(const l of p.seasons){const d=await(await fetch(`${re}/tv/${s}/season/${l.season_number}?api_key=${oe}&language=${t}`)).json();if(!d.episodes)continue;const h=l.season_number===0;n.push(...d.episodes.map(u=>{var v;return{contenido_id:s,temporada:h?0:l.season_number,episodio:u.episode_number,nombre:u.name,fecha_emision:u.air_date,imagen:u.still_path?`https://image.tmdb.org/t/p/w300${u.still_path}`:null,especial:h,duracion:u.runtime||((v=p.episode_run_time)==null?void 0:v[0])||45}}))}if(n.length>0){const{error:l}=await f.from("episodios").upsert(n,{onConflict:"contenido_id,temporada,episodio"});if(l)return console.error("Error upsert episodios:",l),!1;console.log(`${n.length} episodios cargados/actualizados`)}return!0}catch(g){return console.error("Error en cargarTemporadasCapitulos:",g),!1}}const te="b0d797f053110a25f57317b8e7ba3b06",ne="https://api.themoviedb.org/3";async function ie(s,t="es-ES"){var g;try{console.log(`Actualizando duraciones para serie ${s}...`);const n=await(await fetch(`${ne}/tv/${s}?api_key=${te}&language=${t}`)).json();if(!n.seasons)return!1;const l=((g=n.episode_run_time)==null?void 0:g[0])||45,{data:i}=await f.from("episodios").select("id, temporada, episodio").eq("contenido_id",s);if(!(i!=null&&i.length))return!1;const d=[],h=[...new Set(i.map(u=>u.temporada))];for(const u of h)try{const _=await(await fetch(`${ne}/tv/${s}/season/${u}?api_key=${te}&language=${t}`)).json();if(_.episodes)for(const y of _.episodes){const M=i.find(b=>b.temporada===u&&b.episodio===y.episode_number);M&&d.push({id:M.id,duracion:y.runtime||l})}}catch(v){console.warn(`Error cargando temporada ${u}:`,v)}if(d.length>0){for(const u of d)await f.from("episodios").update({duracion:u.duracion}).eq("id",u.id);console.log(`${d.length} duraciones actualizadas`)}return!0}catch(p){return console.error("Error actualizando duraciones:",p),!1}}const Fe="b0d797f053110a25f57317b8e7ba3b06",Re="https://api.themoviedb.org/3";async function le(s,t="es-ES"){try{console.log(`Actualizando duración para película ${s}...`);const g=await fetch(`${Re}/movie/${s}?api_key=${Fe}&language=${t}`);if(!g.ok)return console.error(`Error HTTP ${g.status} para película ${s}`),!1;const p=await g.json();if(!p.runtime)return console.warn(`No se encontró duración para película ${s}`),!1;const{error:n}=await f.from("contenido").update({duracion:p.runtime}).eq("id",s).eq("media_type","movie");return n?(console.error("Error actualizando duración en Supabase:",n),!1):(console.log(`✅ Duración actualizada para película ${s}: ${p.runtime} minutos`),!0)}catch(g){return console.error(`Error actualizando duración de película ${s}:`,g),!1}}async function Ue(){try{console.log("Iniciando migración de duraciones...");const{data:s}=await f.from("episodios").select("contenido_id").not("contenido_id","is",null),t=s!=null&&s.length?[...new Set(s.map(d=>d.contenido_id))]:[],{data:g}=await f.from("contenido").select("id").eq("media_type","movie"),p=(g==null?void 0:g.map(d=>d.id))||[];console.log(`Encontradas ${t.length} series y ${p.length} películas para actualizar`);let n=0,l=0;const i=t.length+p.length;for(const d of t)try{await ie(d)?(n++,console.log(`✅ Serie ${d} actualizada`)):(l++,console.warn(`❌ Error en serie ${d}`)),await new Promise(u=>setTimeout(u,250))}catch(h){l++,console.error(`❌ Error en serie ${d}:`,h)}for(const d of p)try{await le(d)?(n++,console.log(`✅ Película ${d} actualizada`)):(l++,console.warn(`❌ Error en película ${d}`)),await new Promise(u=>setTimeout(u,250))}catch(h){l++,console.error(`❌ Error en película ${d}:`,h)}return console.log(`Migración completada: ${n} exitosos, ${l} fallidos de ${i} elementos`),{exitosos:n,fallidos:l,total:i,series:t.length,peliculas:p.length}}catch(s){throw console.error("Error en migración:",s),s}}const ce="b0d797f053110a25f57317b8e7ba3b06",de="https://api.themoviedb.org/3";async function ue(s,t,g="es-ES"){try{console.log(`Actualizando géneros para ${t} ${s}...`);const n=await fetch(`${de}/${t==="tv"?"tv":"movie"}/${s}?api_key=${ce}&language=${g}`);if(!n.ok)return n.status===404?(console.warn(`⚠️ Contenido ${t} ${s} no encontrado en TMDb (404) - posiblemente eliminado`),await f.from("contenido").update({generos:["No disponible"],ultima_actualizacion:new Date().toISOString()}).eq("id",s).eq("media_type",t),!1):(console.error(`Error HTTP ${n.status} para ${t} ${s}`),!1);const l=await n.json();if(!l.genres||l.genres.length===0)return console.warn(`Sin géneros disponibles para ${t} ${s}`),await f.from("contenido").update({generos:[],ultima_actualizacion:new Date().toISOString()}).eq("id",s).eq("media_type",t),!1;const i=l.genres.map(h=>h.name),{error:d}=await f.from("contenido").update({generos:i,ultima_actualizacion:new Date().toISOString()}).eq("id",s).eq("media_type",t);return d?(console.error("Error actualizando géneros en Supabase:",d),!1):(console.log(`✅ Géneros actualizados para ${t} ${s}:`,i),!0)}catch(p){return console.error(`Error actualizando géneros de ${t} ${s}:`,p),!1}}async function Ge(){try{console.log("Iniciando migración de géneros...");const{data:s,error:t}=await f.from("contenido").select("id, media_type, nombre, generos").or("generos.is.null,generos.eq.{}");if(t)throw console.error("Error en consulta:",t),t;if(!(s!=null&&s.length))return console.log("No hay contenido sin géneros para actualizar"),{exitosos:0,fallidos:0,total:0,noEncontrados:0};const g=s.filter(i=>{const d=i.generos;return!d||d.length===0||Array.isArray(d)&&!d.includes("No disponible")});if(!g.length)return console.log("No hay contenido sin géneros para actualizar (después del filtrado)"),{exitosos:0,fallidos:0,total:0,noEncontrados:0};console.log(`Encontrados ${g.length} elementos sin géneros`);let p=0,n=0,l=0;for(const i of g)try{if(console.log(`🔄 Procesando ${i.media_type} ${i.id} - "${i.nombre}"`),await ue(i.id,i.media_type))p++,console.log(`✅ ${i.media_type} ${i.id} actualizado`);else try{(await fetch(`${de}/${i.media_type==="tv"?"tv":"movie"}/${i.id}?api_key=${ce}`)).status===404?(l++,console.warn(`❌ ${i.media_type} ${i.id} no existe en TMDb`)):(n++,console.warn(`❌ Error en ${i.media_type} ${i.id}`))}catch(h){n++,console.error(`❌ Error verificando ${i.media_type} ${i.id}:`,h)}await new Promise(h=>setTimeout(h,250))}catch(d){n++,console.error(`❌ Error en ${i.media_type} ${i.id}:`,d)}return console.log("Migración de géneros completada:"),console.log(`- Exitosos: ${p}`),console.log(`- Fallidos: ${n}`),console.log(`- No encontrados en TMDb: ${l}`),{exitosos:p,fallidos:n,noEncontrados:l,total:g.length}}catch(s){throw console.error("Error en migración de géneros:",s),s}}const J={emoji:"🏆",nombre:"Logro de Ejemplo",descripcion:"Has desbloqueado un logro de prueba."};function Le({usuarios:s,onNotificacionEnviada:t,series:g=[]}){const[p,n]=m.useState(""),[l,i]=m.useState(""),[d,h]=m.useState(""),[u,v]=m.useState(""),[_,y]=m.useState(""),[M,b]=m.useState(""),R=s.map(x=>e.jsxs("option",{value:x.user_id,children:[x.nick?x.nick:x.user_id," ",x.rol?`(${x.rol})`:""]},x.user_id)),A=[e.jsx("option",{value:"",children:"Sin imagen de serie"},""),...g.map(x=>e.jsxs("option",{value:x.id,children:[x.nombre," (",x.id,")"]},x.id))],U=async x=>{if(x.preventDefault(),!p){b("Debes seleccionar un usuario.");return}b("Enviando...");let w=null;if(_){const E=g.find(G=>String(G.id)===String(_));w=(E==null?void 0:E.imagen)||null}const{error:k}=await f.from("notificaciones_usuario").insert([{user_id:p,titulo:l,mensaje:d,url:u,imagen:w}]);k?b("Error al enviar: "+k.message):(b("¡Notificación enviada!"),i(""),h(""),v(""),n(""),y(""),t&&t())},C=async()=>{if(!p){b("Selecciona un usuario para simular el logro.");return}b("Enviando notificación de logro...");const{error:x}=await f.from("notificaciones_usuario").insert([{user_id:p,titulo:"¡Nuevo logro desbloqueado!",mensaje:`${J.emoji} ${J.nombre}: ${J.descripcion}`,url:"/perfil#logros",imagen:"🎉"}]);x?b("Error al enviar: "+x.message):(b("¡Notificación de logro enviada!"),t&&t())};return e.jsxs("div",{className:"max-w-md mx-auto my-8 p-4 bg-white rounded shadow",children:[e.jsx("h2",{className:"font-bold mb-2",children:"Enviar notificación"}),e.jsxs("form",{onSubmit:U,className:"flex flex-col gap-2",children:[e.jsxs("select",{value:p,onChange:x=>n(x.target.value),className:"border px-2 py-1 rounded",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona usuario"}),R]}),e.jsx("input",{type:"text",placeholder:"Título",value:l,onChange:x=>i(x.target.value),className:"border px-2 py-1 rounded",required:!0}),e.jsx("input",{type:"text",placeholder:"Mensaje",value:d,onChange:x=>h(x.target.value),className:"border px-2 py-1 rounded",required:!0}),e.jsx("input",{type:"text",placeholder:"URL destino (opcional)",value:u,onChange:x=>v(x.target.value),className:"border px-2 py-1 rounded"}),e.jsx("select",{value:_,onChange:x=>y(x.target.value),className:"border px-2 py-1 rounded",children:A}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700",children:"Enviar notificación"})]}),e.jsx("button",{className:"mt-3 bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 w-full",onClick:C,type:"button",children:"Simular notificación de logro"}),M&&e.jsx("div",{className:"mt-2 text-sm",children:M})]})}function sa(){const{usuario:s,perfil:t,esAdmin:g,loading:p}=De(),[n,l]=m.useState([]),[i,d]=m.useState([]),[h,u]=m.useState(!0),[v,_]=m.useState(""),[y,M]=m.useState("id"),[b,R]=m.useState("asc"),[A,U]=m.useState("contenidos"),[C,x]=m.useState(!1),[w,k]=m.useState(null),[E,G]=m.useState(!1),[$,O]=m.useState(null),[Q,me]=m.useState(""),[I,pe]=m.useState(""),[K,ge]=m.useState(""),[D,Y]=m.useState(1),q=25,[xe,he]=m.useState([]),B=n.filter(a=>(a.nombre||"").toLowerCase().includes(Q.toLowerCase())&&(I?a.tipo===I:!0)&&(K===""||String(a.id).includes(K))),P=Math.ceil(B.length/q),[W,fe]=m.useState([]),[Oe,Ie]=m.useState(""),[Ke,Ye]=m.useState(""),[He,Ve]=m.useState(""),[Je,Qe]=m.useState(""),[We,Xe]=m.useState("");m.useEffect(()=>{!s||(t==null?void 0:t.rol)!=="admin"||(u(!0),f.from("contenido").select(`
        id,
        nombre,
        nombre_original,
        tipo,
        media_type,
        anio,
        finalizada,
        ultima_actualizacion,
        sinopsis,
        imagen,
        backdrop,
        generos,
        puntuacion,
        popularidad,
        duracion,
        temporadas,
        episodios_totales,
        estado_serie,
        en_emision,
        reparto,
        original_language,
        origin_country
      `).order(y,{ascending:b==="asc"}).then(({data:a,error:o})=>{o?console.error("Error al cargar contenidos:",o):l(a||[]),u(!1)}))},[s,t==null?void 0:t.rol,y,b]),m.useEffect(()=>{!s||(t==null?void 0:t.rol)!=="admin"||(u(!0),f.from("usuarios").select("user_id, rol").order("user_id",{ascending:!0}).then(({data:a,error:o})=>{o?console.error("Error al cargar usuarios:",o):d(a||[]),u(!1)}))},[s,t==null?void 0:t.rol,y,b,A]);const be=a=>a?new Date(a).toLocaleString("es-ES",{dateStyle:"short",timeStyle:"short"}):"-",c=a=>{_(a),setTimeout(()=>_(""),3e3)},je=async(a,o)=>{await Ce(a,o,"es-ES")?(c(`Contenido ${a} actualizado con éxito`),Te()):c(`Fallo al actualizar ${a}`)},ye=async(a,o)=>{console.log("Actualizando traducciones:",a,o);const r=await Be(a);c(r?`Traducciones de ${a} actualizadas con éxito`:`Fallo al actualizar traducciones de ${a}`)},we=async(a,o)=>{if(console.log("Cargar temporadas/capítulos:",a,o),o!=="tv")return;const r=await se(a,"es-ES");c(r?`Temporadas y capítulos de ${a} cargados con éxito`:`Fallo al cargar temporadas/capítulos de ${a}`)},$e=async(a,o)=>{if(console.log("Forzar actualización de todas las temporadas:",a,o),o!=="tv")return;c("Forzando actualización de todas las temporadas...");const r=await se(a,"es-ES");c(r?`Temporadas y capítulos de ${a} actualizados en Supabase`:`Fallo al actualizar temporadas/capítulos de ${a}`)},Ne=async a=>{if(console.log("Eliminando contenido:",a),!confirm(`¿Seguro que quieres borrar el contenido ${a}?`))return;const{error:o}=await f.from("contenido").delete().eq("id",a);o?(console.error("Error borrando contenido:",o),c(`Error al borrar contenido ${a}`)):(l(r=>r.filter(z=>z.id!==a)),c(`Contenido ${a} borrado`))},S=a=>{y===a?R(o=>o==="asc"?"desc":"asc"):(M(a),R("asc"))},T=a=>y===a?b==="asc"?" ▲":" ▼":"",ve=async(a,o)=>{if(o!=="tv"){c("Solo se pueden actualizar duraciones de series");return}c("Actualizando duraciones de episodios...");const r=await ie(a,"es-ES");c(r?`Duraciones de episodios de ${a} actualizadas`:`Error al actualizar duraciones de ${a}`)},_e=async(a,o)=>{if(o!=="movie"){c("Solo se pueden actualizar duraciones de películas");return}c("Actualizando duración de película...");const r=await le(a,"es-ES");c(r?`Duración de película ${a} actualizada`:`Error al actualizar duración de ${a}`)},ze=async(a,o)=>{if(c("Actualizando géneros..."),await ue(a,o,"es-ES")){c(`Géneros de ${o} ${a} actualizados`),u(!0);const{data:z,error:L}=await f.from("contenido").select("id, nombre, tipo, media_type, anio, finalizada, ultima_actualizacion").order(y,{ascending:b==="asc"});L?console.error("Error al cargar contenidos:",L):l(z||[]),u(!1)}else c(`Error al actualizar géneros de ${a}`)},Ee=async()=>{if(confirm("¿Estás seguro de que quieres migrar las duraciones de todas las series y películas? Esto puede tardar varios minutos.")){x(!0),k(null),c("Iniciando migración de duraciones...");try{const a=await Ue(fe);k(a),c(`✅ Migración completada: ${a.exitosos} exitosos, ${a.fallidos} fallidos de ${a.total} elementos`)}catch(a){console.error("Error en migración:",a),c("❌ Error durante la migración"),k({error:a.message})}finally{x(!1)}}},Se=async()=>{if(confirm("¿Estás seguro de que quieres migrar los géneros de todo el contenido? Esto puede tardar varios minutos.")){G(!0),O(null),c("Iniciando migración de géneros...");try{const a=await Ge();O(a),c(`✅ Migración de géneros completada: ${a.exitosos} exitosos, ${a.fallidos} fallidos de ${a.total} elementos`),u(!0);const{data:o,error:r}=await f.from("contenido").select("id, nombre, tipo, media_type, anio, finalizada, ultima_actualizacion").order(y,{ascending:b==="asc"});r?console.error("Error al cargar contenidos:",r):l(o||[]),u(!1)}catch(a){console.error("Error en migración de géneros:",a),c("❌ Error durante la migración de géneros"),O({error:a.message})}finally{G(!1)}}},Te=async()=>{u(!0);try{const{data:a,error:o}=await f.from("contenido").select("id, nombre, tipo, media_type, anio, finalizada, ultima_actualizacion").order(y,{ascending:b==="asc"});o?(console.error("Error al cargar contenidos:",o),c("Error cargando contenidos")):l(a||[])}catch(a){console.error("Error:",a),c("Error inesperado")}finally{u(!1)}};m.useEffect(()=>{const a=Array.from(new Set(n.map(o=>o.tipo).filter(Boolean)));he(a)},[n]);const H=B.slice((D-1)*q,D*q),[j,F]=m.useState([]),[N,Me]=m.useState("");if(p||!s)return null;if(!g)return e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsx("main",{className:"pt-20 px-4 text-center",children:e.jsx(Z,{texto:"Acceso denegado: solo admins."})}),e.jsx(ae,{})]});const X=async a=>{const o=n.find(z=>z.id===a);if(!o)return;const r=ke(o,o.media_type,o.generos);if(r&&r!==o.tipo){const{error:z}=await f.from("contenido").update({tipo:r}).eq("id",a);z?c("Error al actualizar el tipo"):(l(L=>L.map(V=>V.id===a?{...V,tipo:r}:V)),c(`Tipo recalculado: ${r}`))}else c("El tipo ya está correcto")},Ae=async()=>{for(const a of j)await X(a),await new Promise(o=>setTimeout(o,150));c("Tipos recalculados")};return i.map(a=>e.jsxs("option",{value:a.user_id,children:[a.nick?a.nick:a.user_id," ",a.rol?`(${a.rol})`:""]},a.user_id)),e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsx(Z,{texto:v}),e.jsxs("main",{className:"pt-20 px-4 max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Panel de Administración"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("button",{onClick:()=>U("contenidos"),className:`px-4 py-2 rounded-l-lg font-medium transition-all ${A==="contenidos"?"bg-blue-600 text-white shadow-md":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"📺 Contenidos"}),e.jsx("button",{onClick:()=>U("usuarios"),className:`px-4 py-2 rounded-r-lg font-medium transition-all ${A==="usuarios"?"bg-blue-600 text-white shadow-md":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"👥 Usuarios"})]}),h?e.jsxs("p",{children:["Cargando ",A==="contenidos"?"contenidos":"usuarios","…"]}):A==="contenidos"?n.length===0?e.jsx("p",{children:"No hay contenidos en la base de datos."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar por nombre...",value:Q,onChange:a=>me(a.target.value),className:"border px-2 py-1 rounded"}),e.jsxs("select",{value:I,onChange:a=>pe(a.target.value),className:"border px-2 py-1 rounded",children:[e.jsx("option",{value:"",children:"Todos los tipos"}),xe.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsx("input",{type:"text",placeholder:"Buscar por ID...",value:K,onChange:a=>ge(a.target.value),className:"border px-2 py-1 rounded w-24"})]}),e.jsxs("div",{className:"my-4 flex gap-2 items-center",children:[e.jsxs("select",{value:N,onChange:a=>Me(a.target.value),className:"border px-2 py-1 rounded",children:[e.jsx("option",{value:"",children:"Selecciona una acción"}),e.jsx("option",{value:"borrar",children:"Borrar seleccionados"}),e.jsx("option",{value:"actualizar_contenido",children:"Actualizar contenido"}),e.jsx("option",{value:"actualizar_traducciones",children:"Actualizar traducciones"}),e.jsx("option",{value:"cargar_temporadas",children:"Cargar temporadas/capítulos"}),e.jsx("option",{value:"forzar_actualizar_temporadas",children:"Forzar actualización temporadas"}),e.jsx("option",{value:"actualizar_duraciones",children:"Actualizar duraciones (series)"}),e.jsx("option",{value:"actualizar_duracion_pelicula",children:"Actualizar duración (películas)"}),e.jsx("option",{value:"actualizar_generos",children:"Actualizar géneros"}),e.jsx("option",{value:"recalcular_tipo",children:"Recalcular tipo"})]}),e.jsx("button",{className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700",onClick:async()=>{if(j.length===0){c("Selecciona al menos un elemento");return}if(!N){c("Selecciona una acción");return}if(u(!0),N==="borrar"){if(!confirm(`¿Seguro que quieres borrar ${j.length} contenidos?`)){u(!1);return}const{error:a}=await f.from("contenido").delete().in("id",j);a?c("Error al borrar contenidos seleccionados"):(l(o=>o.filter(r=>!j.includes(r.id))),F([]),c("Contenidos borrados correctamente"))}if(N==="actualizar_contenido"){for(const a of j){const o=n.find(r=>r.id===a);o&&await je(o.id,o.media_type),await new Promise(r=>setTimeout(r,250))}c("Contenidos actualizados")}if(N==="actualizar_traducciones"){for(const a of j){const o=n.find(r=>r.id===a);o&&await ye(o.id,o.media_type),await new Promise(r=>setTimeout(r,250))}c("Traducciones actualizadas")}if(N==="cargar_temporadas"){for(const a of j){const o=n.find(r=>r.id===a);o&&o.media_type==="tv"&&await we(o.id,o.media_type),await new Promise(r=>setTimeout(r,250))}c("Temporadas/capítulos cargados")}if(N==="forzar_actualizar_temporadas"){for(const a of j){const o=n.find(r=>r.id===a);o&&o.media_type==="tv"&&await $e(o.id,o.media_type),await new Promise(r=>setTimeout(r,250))}c("Temporadas actualizadas")}if(N==="actualizar_duraciones"){for(const a of j){const o=n.find(r=>r.id===a);o&&o.media_type==="tv"&&await ve(o.id,o.media_type),await new Promise(r=>setTimeout(r,250))}c("Duraciones de series actualizadas")}if(N==="actualizar_duracion_pelicula"){for(const a of j){const o=n.find(r=>r.id===a);o&&o.media_type==="movie"&&await _e(o.id,o.media_type),await new Promise(r=>setTimeout(r,250))}c("Duraciones de películas actualizadas")}if(N==="actualizar_generos"){for(const a of j){const o=n.find(r=>r.id===a);o&&await ze(o.id,o.media_type),await new Promise(r=>setTimeout(r,250))}c("Géneros actualizados")}if(N==="recalcular_tipo"){await Ae(),u(!1);return}u(!1)},children:"Aplicar"})]}),e.jsxs("table",{className:"w-full table-auto border-collapse text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"border px-2 py-1",children:e.jsx("input",{type:"checkbox",checked:j.length>0&&j.length===H.length,onChange:a=>{a.target.checked?F(H.map(o=>o.id)):F([])}})}),e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>S("id"),children:["ID",T("id")]}),e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>S("nombre"),children:["Nombre",T("nombre")]}),e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>S("tipo"),children:["Tipo",T("tipo")]}),e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>S("anio"),children:["Año",T("anio")]}),e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>S("finalizada"),children:["Finalizada",T("finalizada")]}),e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>S("ultima_actualizacion"),children:["Última Actualización",T("ultima_actualizacion")]}),e.jsx("th",{className:"border px-2 py-1",children:"Título original"}),e.jsx("th",{className:"border px-2 py-1",children:"Puntuación"}),e.jsx("th",{className:"border px-2 py-1",children:"Géneros"}),e.jsx("th",{className:"border px-2 py-1",children:"Imagen"})]})}),e.jsx("tbody",{children:H.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1",children:e.jsx("input",{type:"checkbox",checked:j.includes(a.id),onChange:o=>{o.target.checked?F(r=>[...r,a.id]):F(r=>r.filter(z=>z!==a.id))}})}),e.jsx("td",{className:"border px-2 py-1",children:a.id}),e.jsx("td",{className:"border px-2 py-1",children:e.jsx("a",{href:`#/detalle/${a.media_type}/${a.id}`,className:"text-blue-700 underline hover:text-blue-900",target:"_blank",rel:"noopener noreferrer",children:a.nombre||e.jsx("span",{className:"text-gray-400 italic",children:"Sin nombre"})})}),e.jsx("td",{className:"border px-2 py-1",children:a.tipo}),e.jsx("td",{className:"border px-2 py-1",children:a.anio}),e.jsx("td",{className:"border px-2 py-1",children:a.finalizada?"Sí":"No"}),e.jsx("td",{className:"border px-2 py-1",children:be(a.ultima_actualizacion)}),e.jsx("td",{className:"border px-2 py-1",children:a.nombre_original}),e.jsx("td",{className:"border px-2 py-1",children:a.puntuacion??"-"}),e.jsx("td",{className:"border px-2 py-1",children:Array.isArray(a.generos)?a.generos.join(", "):typeof a.generos=="string"?a.generos:"-"}),e.jsx("td",{className:"border px-2 py-1",children:a.imagen&&e.jsx("img",{src:a.imagen,alt:a.nombre||"miniatura",style:{width:40,borderRadius:4,objectFit:"cover"}})}),e.jsx("td",{className:"border px-2 py-1",children:e.jsx("button",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded hover:bg-blue-200",onClick:()=>X(a.id),title:"Recalcular tipo",children:"Recalcular tipo"})})]},a.id))})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-2 my-4",children:[e.jsxs("span",{children:["Mostrando"," ",B.length===0?0:(D-1)*q+1,"-",Math.min(D*q,B.length)," de"," ",B.length," resultados"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 rounded bg-gray-200 hover:bg-gray-300",onClick:()=>Y(a=>Math.max(1,a-1)),disabled:D===1,"aria-label":"Página anterior",children:"Anterior"}),e.jsxs("span",{children:["Página"," ",e.jsx("input",{type:"number",min:1,max:P,value:D,onChange:a=>{let o=Number(a.target.value);(isNaN(o)||o<1)&&(o=1),o>P&&(o=P),Y(o)},className:"w-12 text-center border rounded","aria-label":"Número de página"})," ","de ",P]}),e.jsx("button",{className:"px-2 py-1 rounded bg-gray-200 hover:bg-gray-300",onClick:()=>Y(a=>Math.min(P,a+1)),disabled:D===P,"aria-label":"Página siguiente",children:"Siguiente"})]})]})]}):e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full table-auto border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>S("user_id"),children:["ID",T("user_id")]}),e.jsxs("th",{className:"border px-2 py-1 cursor-pointer",onClick:()=>S("rol"),children:["Rol",T("rol")]}),e.jsx("th",{className:"border px-2 py-1",children:"Acciones"})]})}),e.jsx("tbody",{children:i.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1",children:a.user_id}),e.jsx("td",{className:"border px-2 py-1",children:a.rol}),e.jsx("td",{className:"border px-2 py-1 space-x-2",children:e.jsx("button",{onClick:()=>Ne(a.user_id),className:"text-sm bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700",children:"Borrar usuario"})})]},a.user_id))})]})}),e.jsxs("section",{className:"mt-8 p-6 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-yellow-800",children:"🚀 Migración de Datos"}),C&&e.jsxs("div",{className:"flex items-center gap-2 text-yellow-700",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-yellow-600"}),e.jsx("span",{className:"text-sm",children:"Procesando..."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-800 mb-2",children:"Actualizar Duraciones de Episodios"}),e.jsx("p",{className:"text-sm text-yellow-700 mb-3",children:"Actualiza las duraciones de todos los episodios existentes desde TMDb. Esto puede tardar varios minutos dependiendo del número de series."}),e.jsx("button",{onClick:Ee,disabled:C,className:`px-4 py-2 text-white rounded font-medium transition-colors ${C?"bg-gray-400 cursor-not-allowed":"bg-yellow-600 hover:bg-yellow-700"}`,children:C?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-pulse mr-2",children:"⏳"}),"Migrando duraciones..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2",children:"⏱️"}),"Migrar Duraciones"]})})]}),w&&e.jsxs("div",{className:`p-4 rounded-lg ${w.error?"bg-red-50 border border-red-200":"bg-green-50 border border-green-200"}`,children:[e.jsx("h4",{className:`font-semibold mb-2 ${w.error?"text-red-800":"text-green-800"}`,children:w.error?"❌ Error en la migración":"✅ Migración completada"}),w.error?e.jsx("p",{className:"text-red-700 text-sm",children:w.error}):e.jsxs("div",{className:"text-green-700 text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Total de series procesadas:"})," ",w.total]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Actualizaciones exitosas:"})," ",w.exitosos]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Errores:"})," ",w.fallidos]}),w.fallidos>0&&e.jsx("p",{className:"text-yellow-600",children:"⚠️ Revisa la consola para ver detalles de los errores"})]})]}),e.jsxs("div",{className:"text-xs text-yellow-600 space-y-1",children:[e.jsx("p",{children:"• Esta operación consultará la API de TMDb para cada serie"}),e.jsx("p",{children:"• Se aplicará un retraso de 250ms entre consultas para respetar los límites de la API"}),e.jsx("p",{children:"• Los logs detallados se mostrarán en la consola del navegador"})]})]})]}),e.jsxs("section",{className:"mt-8 p-6 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-green-800",children:"🎭 Migración de Géneros"}),E&&e.jsxs("div",{className:"flex items-center gap-2 text-green-700",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600"}),e.jsx("span",{className:"text-sm",children:"Procesando..."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-green-800 mb-2",children:"Actualizar Géneros desde TMDb"}),e.jsx("p",{className:"text-sm text-green-700 mb-3",children:"Actualiza los géneros de todo el contenido que no tenga géneros asignados desde TMDb."}),e.jsx("button",{onClick:Se,disabled:E,className:`px-4 py-2 text-white rounded font-medium transition-colors ${E?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:E?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-pulse mr-2",children:"⏳"}),"Migrando géneros..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2",children:"🎭"}),"Migrar Géneros"]})})]}),$&&e.jsxs("div",{className:`p-4 rounded-lg ${$.error?"bg-red-50 border border-red-200":"bg-green-50 border border-green-200"}`,children:[e.jsx("h4",{className:`font-semibold mb-2 ${$.error?"text-red-800":"text-green-800"}`,children:$.error?"❌ Error en la migración":"✅ Migración completada"}),$.error?e.jsx("p",{className:"text-red-700 text-sm",children:$.error}):e.jsxs("div",{className:"text-green-700 text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Total de elementos procesados:"})," ",$.total]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Actualizaciones exitosas:"})," ",$.exitosos]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Errores:"})," ",$.fallidos]}),$.noEncontrados>0&&e.jsxs("p",{children:[e.jsx("strong",{children:"No encontrados en TMDb:"})," ",e.jsx("span",{className:"text-yellow-600",children:$.noEncontrados})]}),($.fallidos>0||$.noEncontrados>0)&&e.jsx("p",{className:"text-yellow-600 mt-2",children:"⚠️ Revisa la consola para ver detalles"})]})]})]})]}),W.length>0&&e.jsx("div",{className:"bg-gray-900 text-green-200 p-2 mt-2 rounded max-h-40 overflow-y-auto text-xs",children:W.map((a,o)=>e.jsx("div",{children:a},o))}),e.jsx(Le,{usuarios:i,series:n.filter(a=>a.tipo==="serie"||a.media_type==="tv"),onNotificacionEnviada:()=>{window.dispatchEvent(new Event("notificacion-enviada"))}})]}),e.jsx(ae,{})]})}export{sa as default};
